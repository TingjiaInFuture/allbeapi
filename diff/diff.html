<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diff API Test</title>
    <style>
        body { font-family: 'Arial', sans-serif; margin: 0; padding: 0; background-color: #f8f9fa; color: #333; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; padding-top: 20px; padding-bottom: 20px; }
        .container { background-color: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 90%; max-width: 1200px; }
        h1 { text-align: center; color: #007bff; margin-bottom: 25px; }
        .text-areas { display: flex; justify-content: space-between; margin-bottom: 20px; gap: 20px; }
        .text-areas div { flex: 1; }
        textarea {
            width: calc(100% - 20px); /* Full width minus padding */
            min-height: 250px;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
            line-height: 1.4;
            box-sizing: border-box;
        }
        .controls { display: flex; align-items: center; justify-content: space-between; margin-bottom: 25px; flex-wrap: wrap; gap: 15px; }
        .controls label, .controls select, .controls button {
            margin-right: 10px; /* Spacing for non-wrapped items */
        }
        select, button {
            padding: 10px 18px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 1em;
            background-color: #e9ecef;
        }
        button {
            background-color: #28a745;
            color: white;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
        }
        button:hover { background-color: #218838; }
        #resultContainer { margin-top: 20px; padding: 15px; border: 1px solid #dee2e6; border-radius: 6px; background-color: #f8f9fa; min-height: 100px; }
        #resultContainer pre {
            white-space: pre-wrap; 
            word-wrap: break-word; 
            background-color: #fff; 
            padding: 10px; 
            border-radius: 4px; 
            border: 1px solid #eee;
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
        }
        /* Styles for HTML diff output */
        #resultContainer pre span {
            display: inline-block; /* Ensures background color covers the whole token */
            padding: 1px 0;
        }
        #resultContainer pre span[style*="background-color: #e6ffed"] { /* Added */
            background-color: #e6ffed !important;
            color: #22863a !important;
            font-weight: bold !important;
        }
        #resultContainer pre span[style*="background-color: #ffeef0"] { /* Removed */
            background-color: #ffeef0 !important;
            color: #b31d28 !important;
            text-decoration: line-through !important;
        }
        #resultContainer pre span[style*="color: #586069"] { /* Unchanged */
            color: #586069 !important;
        }
        .error { color: #dc3545; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Text Diff API</h1>
        <div class="text-areas">
            <div>
                <label for="text1Input">Text 1:</label>
                <textarea id="text1Input" placeholder="Enter first text here...">The quick brown fox jumps over the lazy dog.</textarea>
            </div>
            <div>
                <label for="text2Input">Text 2:</label>
                <textarea id="text2Input" placeholder="Enter second text here...">The quick red fox jumps over the sleepy cat.</textarea>
            </div>
        </div>

        <div class="controls">
            <div>
                <label for="diffType">Diff Type:</label>
                <select id="diffType">
                    <option value="chars">Characters</option>
                    <option value="words" selected>Words</option>
                    <option value="wordsWithSpace">Words with Space</option>
                    <option value="lines">Lines</option>
                    <option value="trimmedLines">Trimmed Lines</option>
                    <option value="sentences">Sentences</option>
                    <option value="css">CSS</option>
                    <option value="json">JSON</option>
                </select>
            </div>
            <div>
                <label for="outputFormat">Output Format:</label>
                <select id="outputFormat">
                    <option value="json_array" selected>JSON Array (default)</option>
                    <option value="html">HTML</option>
                    <option value="patch">Patch (Unified Diff)</option>
                </select>
            </div>
            <button onclick="compareTexts()">Compare Texts</button>
        </div>

        <h2>Comparison Result:</h2>
        <div id="resultContainer">
            <pre id="diffOutput">Results will appear here...</pre>
        </div>
        <div id="errorOutput" class="error"></div>
    </div>

    <script>
        async function compareTexts() {
            const text1 = document.getElementById('text1Input').value;
            const text2 = document.getElementById('text2Input').value;
            const type = document.getElementById('diffType').value;
            const outputFormat = document.getElementById('outputFormat').value;
            const diffOutput = document.getElementById('diffOutput');
            const errorOutput = document.getElementById('errorOutput');

            diffOutput.innerHTML = 'Comparing...'; // Use innerHTML for HTML content
            errorOutput.textContent = '';

            let bodyPayload = { text1, text2, type, outputFormat };

            // For JSON diff, try to parse if inputs are strings, otherwise send as is (if they were objects already)
            if (type === 'json') {
                try {
                    bodyPayload.text1 = JSON.parse(text1); 
                } catch (e) { /* Ignore if not valid JSON string, API will handle it or it might be an object already */ }
                try {
                    bodyPayload.text2 = JSON.parse(text2);
                } catch (e) { /* Ignore */ }
            }

            try {
                const response = await fetch('http://127.0.0.1:5006/compare', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(bodyPayload),
                });

                const result = await response.json();

                if (response.ok) {
                    if (result.format === 'html') {
                        diffOutput.innerHTML = result.diff; // Render HTML directly
                    } else if (result.format === 'patch') {
                        diffOutput.textContent = result.diff; // Display patch as text
                    } else { // json_array
                        diffOutput.textContent = JSON.stringify(result.diff, null, 2);
                    }
                } else {
                    errorOutput.textContent = `Error: ${result.error}`;
                    if (result.details) errorOutput.textContent += ` - ${result.details}`;
                    diffOutput.textContent = 'Comparison failed.';
                }
            } catch (error) {
                errorOutput.textContent = `Network or other error: ${error.message}`;
                diffOutput.textContent = 'Comparison failed due to a network or script error.';
            }
        }
    </script>
</body>
</html>
