<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mermaid CLI API</title>
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <header>
        <h1>Mermaid CLI API</h1>
        <nav>
            <a href="../index.html">Home</a>
        </nav>
    </header>
    <main>
        <section>
            <h2>Generate Diagram</h2>
            <p>Endpoint: <code>/generate-diagram</code> (POST)</p>
            <p>Generates a diagram from a Mermaid definition.</p>
            <h3>Request Body:</h3>
            <pre><code>{
    "definition": "graph TD; A-->B;",
    "format": "svg" // Optional, defaults to svg. Can be "png".
}</code></pre>
            <h3>Example Usage (JavaScript):</h3>
            <pre><code>
fetch('http://localhost:3008/generate-diagram', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
    },
    body: JSON.stringify({
        definition: "graph TD; Start --> Stop",
        format: "svg"
    }),
})
.then(response => response.json())
.then(data => {
    console.log(data);
    if (data.filePath) {
        // Assuming the API returns a path that can be accessed via a GET request
        // or you might want to display the image directly if it returns base64 data
        document.getElementById('mermaidDiagram').innerHTML = `&lt;img src="http://localhost:3008${data.filePath}" alt="Generated Diagram"&gt;`;
    }
})
.catch(error => console.error('Error:', error));
            </code></pre>
            <h3>Test Area:</h3>
            <textarea id="mermaidDefinition" placeholder="Enter Mermaid definition (e.g., graph TD; A-->B;)" rows="5" style="width: 100%;">graph TD;
    A[Christmas] -->|Get money| B(Go shopping);
    B --> C{Let me think};
    C -->|One| D[Laptop];
    C -->|Two| E[iPhone];
    C -->|Three| F[Car];</textarea>
            <label for="diagramFormat">Format:</label>
            <select id="diagramFormat">
                <option value="svg">SVG</option>
                <option value="png">PNG</option>
            </select>
            <button onclick="testGenerateDiagram()">Generate Diagram</button>
            <h3>Result:</h3>
            <div id="mermaidDiagram"></div>
            <pre id="mermaidResponse"></pre>
        </section>
    </main>
    <footer>
        <p>&copy; 2024 API Collection</p>
    </footer>
    <script>
        async function testGenerateDiagram() {
            const definition = document.getElementById('mermaidDefinition').value;
            const format = document.getElementById('diagramFormat').value;
            const responseElement = document.getElementById('mermaidResponse');
            const diagramElement = document.getElementById('mermaidDiagram');
            diagramElement.innerHTML = ''; // Clear previous diagram
            responseElement.textContent = ''; // Clear previous response

            try {
                const response = await fetch('http://localhost:3008/generate-diagram', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ definition, format }),
                });
                const data = await response.json();
                if (response.ok) {
                    responseElement.textContent = JSON.stringify(data, null, 2);
                    if (data.filePath) {
                        const img = document.createElement('img');
                        img.src = `http://localhost:3008${data.filePath}?t=${new Date().getTime()}`; // Add timestamp to avoid caching issues
                        img.alt = "Generated Diagram";
                        img.style.maxWidth = "100%";
                        diagramElement.appendChild(img);
                    }
                } else {
                    responseElement.textContent = 'Error: ' + (data.error || response.statusText) + (data.details ? `\nDetails: ${data.details}` : '');
                }
            } catch (error) {
                responseElement.textContent = 'Error: ' + error.message;
            }
        }
    </script>
</body>
</html>
